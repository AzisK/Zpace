---
name: Trivia on a pull request
on:
  pull_request:
    types: [opened]

jobs:
  trivia:
    runs-on: ubuntu-latest

    steps:
      - name: Post Trivia Questions
        uses: actions/github-script@v7
        with:
          script: |
            const res = await fetch("https://opentdb.com/api.php?amount=3&difficulty=medium&type=multiple");
            const data = await res.json();
            
            function decodeHtml(html) {
              const txt = document.createElement("textarea");
              txt.innerHTML = html;
              return txt.value;
            }

            const questions = data.results.map((q, i) => {
              const choices = [...q.incorrect_answers, q.correct_answer]
                .sort(() => Math.random() - 0.5)
                .map((a, idx) => `> ${String.fromCharCode(65 + idx)}. ${decodeHtmfl(a)}`)
                .join("\n");
              return `### ğŸ§© Q${i + 1}: ${decodeHtml(q.question)}\n${choices}\n\n`;
            }).join("\n---\n\n");

            const header = "**â¸œ(ï½¡Ëƒ áµ• Ë‚ )â¸â™¡ Thank you for opening this Pull Request!**\n\n **( Ë¶Â°ã…Â°) !! It's Trivia Time!** \nHere are 3 trivia questions to keep you entertained while CI runs.\n*(Feel free to demonstrate you knowledge and reply!)*\n\n";
            const body = header + questions;

            await github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body
            });
