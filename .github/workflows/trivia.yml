---
name: Trivia on a pull request
on:
  pull_request:
    types: [opened]

jobs:
  trivia:
    runs-on: ubuntu-latest

    steps:
      - name: Post Trivia Questions
        uses: actions/github-script@v7
        with:
          script: |
            const res = await fetch("https://opentdb.com/api.php?amount=3&difficulty=medium&type=multiple");
            const data = await res.json();

            function decodeHtml(html) {
              return html
                .replace(/&quot;/g, '"')
                .replace(/&#039;/g, "'")
                .replace(/&amp;/g, "&")
                .replace(/&lt;/g, "<")
                .replace(/&gt;/g, ">");
            }

            const questions = data.results.map((q, i) => {
              const choices = [...q.incorrect_answers, q.correct_answer]
                .sort(() => Math.random() - 0.5)
                .map((a, idx) => `> ${String.fromCharCode(65 + idx)}. ${decodeHtml(a)}`)
                .join("\\n");
              return `### ðŸ§© Q${i + 1}: ${decodeHtml(q.question)}\\n${choices}\\n\\n`;
            }).join("\\n---\\n\\n");

            const body = `
ðŸ‘‹ **Thank you for opening this Pull Request!**

ðŸ§  **CI Trivia Time!**
Here are 3 random computer trivia questions to keep you entertained while CI runs.  
*(You can reply with your guesses!)*

${questions}
            `;

            await github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body
            });
